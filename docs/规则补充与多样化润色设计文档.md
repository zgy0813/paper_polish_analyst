# 规则补充与多样化润色设计文档

## 📋 概述

本文档详细阐述论文风格分析与润色系统的规则整合策略。系统采用"并集思维"，通过规则多样性收集和优先级排序，确保规则库的完整性和丰富性，为用户提供全面的写作指导。

## 🔄 设计理念

### 并集思维的核心原则

**并集思维的优势**：
- 确保规则库的完整性和丰富性
- 通过多样性收集提供全面选择
- 基于优先级排序保证规则质量
- 提供灵活的写作指导

**规则整合策略**：
- 官方规则具有最高优先级
- 经验规则通过多样性收集整合
- 按出现频率确定规则类型
- 智能整合规则多样性

### 核心特性

1. **规则收集策略**：通过并集整合确保规则丰富性
2. **多样性整合**：自动收集和整合规则多样性
3. **优先级排序**：官方规则 > 核心规则 > 可选规则 > 建议规则
4. **质量控制**：基于出现频率和统计证据分类规则

## 🏗️ 规则分类体系

### 基于出现频率的分类架构

```
核心规则 (80%+出现频率)
├── 高频经验规则
├── 经过多样性整合验证
└── 强烈推荐的写作模式

可选规则 (50%-80%出现频率)
├── 中等频率经验规则
├── 通过多样性整合筛选
└── 推荐的写作选择

建议规则 (<50%出现频率)
├── 低频经验规则
├── 多样化的创新模式
└── 可选的写作参考

官方规则 (最高优先级)
├── 来自官方风格指南
├── 必须遵循的期刊要求
└── 权威性写作标准
```

### 规则分类标准

**核心规则 (Core Rules)**：
- 出现频率：80%+论文遵循
- 特征：经过多样性整合验证的高质量规则
- 应用：强烈推荐的写作模式
- 示例：高频的句式结构、词汇选择

**可选规则 (Optional Rules)**：
- 出现频率：50%-80%论文遵循
- 特征：通过多样性整合筛选的中等质量规则
- 应用：推荐的写作选择
- 示例：中等频率的表达方式、结构模式

**建议规则 (Suggested Rules)**：
- 出现频率：<50%论文遵循
- 特征：多样化但使用率较低的新颖规则
- 应用：可选的写作参考
- 示例：创新表达方式、特殊情境写作模式

**官方规则 (Official Rules)**：
- 优先级：最高（来自官方风格指南）
- 特征：必须遵循的期刊要求
- 应用：权威性写作标准
- 示例：格式要求、引用规范、表达规范

## 📊 批次处理策略

### 批次角色定义

**batch_01 - 核心基准建立**：
- 角色：建立核心基准规则
- 内容：提取高频规则作为基础
- 作用：为后续批次提供比较标准和多样性整合基准

**batch_02-N - 规则持续整合**：
- 角色：持续整合和验证规则
- 内容：发现新规则并通过多样性整合筛选
- 作用：丰富规则库，确保规则完整性和丰富性

### 停止条件优化

**基于并集思维的停止条件**：
```python
def _should_stop_analysis(self, current_batch, all_batches):
    # 1. 检查最小批次数 (≥5)
    if len(all_batches) < Config.MIN_BATCHES_FOR_CONSISTENCY:
        return False
    
    # 2. 检查规则多样性是否充足 (≥0.9)
    diversity = self._calculate_rule_diversity(all_batches)
    if diversity >= Config.RULE_DIVERSITY_THRESHOLD:
        return True
    
    # 3. 检查冲突规则是否已解决
    conflicts = self._count_rule_conflicts(all_batches)
    if conflicts == 0:  # 无冲突规则
        return True
    
    # 4. 检查是否达到最大批次数 (≤10)
    if len(all_batches) >= Config.MAX_BATCHES_FOR_INTEGRATION:
        return True
    
    return False
```

## 🎨 论文润色框架

### 预设风格模板

**保守风格 (Conservative)**：
- 规则来源：官方规则 + 核心规则 (80%+频率)
- 特点：权威、稳定、规范
- 适用：正式学术论文、期刊投稿
- 修改强度：最小化，确保合规性

**平衡风格 (Balanced)**：
- 规则来源：官方规则 + 核心规则 + 可选规则
- 特点：权威与创新并重、平衡发展
- 适用：一般学术写作、会议论文
- 修改强度：中等，适度优化

**创新风格 (Innovative)**：
- 规则来源：所有规则类型（经过多样性整合）
- 特点：多样化、个性化、创新
- 适用：创意写作、特殊领域
- 修改强度：最大化，充分优化

### 智能规则推荐系统

```python
def recommend_style_choices(self, paper_features: Dict) -> Dict:
    """
    基于论文特征推荐合适的风格选择
    """
    recommendations = {}
    
    # 分析论文特征
    if paper_features['sentence_complexity'] > 0.7:
        recommendations['sentence_structure'] = 'balanced'
    elif paper_features['academic_level'] > 0.8:
        recommendations['sentence_structure'] = 'conservative'
    else:
        recommendations['sentence_structure'] = 'innovative'
    
    return recommendations
```

### 多选项修改建议

**句式结构调整选项**：
```json
{
  "conservative": {
    "description": "保守风格 - 遵循60%+论文的模式",
    "rules": ["复合句比例 > 0.5", "平均句长 15-20 词"],
    "modifications": [...]
  },
  "balanced": {
    "description": "平衡风格 - 结合高频和常见模式",
    "rules": ["复合句比例 0.4-0.7", "平均句长 14-22 词"],
    "modifications": [...]
  },
  "innovative": {
    "description": "创新风格 - 包含替代模式",
    "rules": ["复合句比例 0.3-0.8", "平均句长 12-25 词"],
    "modifications": [...]
  }
}
```

## 🔧 技术实现架构

### 核心模块重构

**增量分析器 (IncrementalAnalyzer)**：
- 新增：规则多样性计算
- 新增：新规则统计
- 新增：规则演进追踪
- 修改：停止条件逻辑

**分层分析器 (LayeredAnalyzer)**：
- 新增：并集整合方法
- 新增：规则频率分类
- 新增：核心规则提取
- 新增：补充规则提取

**润色器 (MultiRoundPolisher)**：
- 新增：风格选择系统
- 新增：多选项生成
- 新增：智能推荐
- 新增：用户交互界面

### 数据结构设计

**新的风格指南格式**：
```json
{
  "version": "2.0",
  "approach": "rule_supplementation",
  "rule_categories": {
    "frequent_rules": {
      "threshold": "60%+",
      "count": 15,
      "rules": [...]
    },
    "common_rules": {
      "threshold": "30%-60%",
      "count": 25,
      "rules": [...]
    },
    "alternative_rules": {
      "threshold": "10%-30%",
      "count": 20,
      "rules": [...]
    }
  },
  "rule_evolution": {
    "batch_01": {
      "description": "建立核心基准规则",
      "rules_count": 12
    },
    "batch_02": {
      "description": "补充了5条新规则",
      "new_rules_count": 5
    }
  },
  "style_templates": {
    "conservative": {...},
    "balanced": {...},
    "innovative": {...}
  }
}
```

## 📈 预期效果

### 规则收集效果

**传统方法**：
- 核心规则：8-12条
- 可选规则：5-8条
- 总规则数：13-20条

**新方法**：
- 高频规则：15-20条
- 常见规则：20-30条
- 替代规则：15-25条
- 总规则数：50-75条

### 润色选择效果

**传统润色**：
- 选择：接受/拒绝
- 风格：单一标准
- 控制：被动接受

**新润色**：
- 选择：多种风格选项
- 风格：多样化选择
- 控制：主动选择

### 用户体验提升

1. **更多选择**：从单一标准到多种风格
2. **更好控制**：从被动接受到主动选择
3. **更高质量**：基于更多规则的优化
4. **更强适应性**：适应不同写作需求

## 🚀 实施策略

### 阶段一：核心逻辑实现
- 创建设计文档
- 调整配置文件
- 更新Prompt模板
- 重构分析器模块

### 阶段二：测试与验证
- 使用现有数据测试
- 验证规则分类效果
- 调整参数和逻辑

### 阶段三：润色功能实现
- 实现风格选择系统
- 添加用户交互界面
- 创建测试用例

### 阶段四：文档和优化
- 更新使用文档
- 性能优化
- 用户反馈收集

## 📝 总结

本设计文档阐述了系统采用"并集思维"的规则整合策略，通过多样性收集、优先级排序和完整性验证，确保规则库的完整性和丰富性。这种设计保证了学术写作的多样性和灵活性，为用户提供全面、可信赖的论文润色服务。
